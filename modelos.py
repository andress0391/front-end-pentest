#!/usr/bin/python3
# -*- encoding: utf-8 -*-

from pentestingWeb import db

from sqlalchemy import Column, Integer, String, DateTime, Numeric, Text, ForeignKey

class Pentest(db.Model):
    __tablename__ = "pentest"
    id = Column('id', Integer, primary_key=True)
    nombre = Column('nombre', String(50))
    url_ip = Column('url_ip', String(50))
    fecha_ini = Column('fecha_ini', DateTime)
    fecha_fin = Column('fecha_fin', DateTime)
    riesgo_general = Column('riesgo_general', Numeric(precision=10, scale=2))

    def __init__(self, url_ip, nombre):
        self.nombre = nombre
        self.url_ip = url_ip

class Subcategoria(db.Model):
    __tablename__ = "subcategoria"
    id = Column('id', Integer, primary_key=True)
    sub_nombre = Column('nombre', String(45))
class A_Top10_2017(db.Model):
    __tablename__ = "a_top10_2017"
    id = Column('id', Integer, primary_key=True)
    titulo = Column('titulo', String(50))
    descripcion = Column('descripcion', String(50))

class Prueba(db.Model):
    __tablename__ = "prueba"
    id = Column('id', Integer, primary_key=True)
    codigo = Column('codigo', String(25))
    nombre = Column('nombre', String(75))
    descripcion = Column('descripcion', Text)
    impacto = Column('objetivo', Text)
    riesgo_imptecnico = Column('riesgo_imptecnico', Numeric(precision=10, scale=2))
    riesgo_probabilidad = Column('riesgo_probabilidad', Numeric(precision=10, scale=2))
    id_subcategoria = Column('id_subcategoria', ForeignKey('subcategoria.id'))
    id_a_top10_2017 = Column('id_a_top10_2017', ForeignKey('a_top10_2017.id'))

class Riesgo_cualitativo(db.Model):
    __tablename__ = "riesgo_cualitativo"
    id = Column('id', Integer, primary_key=True)
    nombre_riesgoc = Column('nombre', String(20))

class Detalle(db.Model):
    __tablename__ = "detalle"
    id = Column('id', Integer, primary_key=True)
    id_pentest = Column('id_pentest', ForeignKey('pentest.id'))
    id_prueba = Column('id_prueba', ForeignKey('prueba.id'))
    id_riesgoc = Column('id_riesgoc', ForeignKey('riesgo_cualitativo.id'))
    riesgo = Column('riesgo', Numeric(precision=10, scale=2))
    resultado = Column('resultado', Text)
    recomendacion = Column('recomendacion', Text)

def eliminarPentest(id_pentest):
    Pentest.query.filter(Pentest.id == id_pentest).delete()
    db.session.commit()

def crearPentest(pentest):
    db.session.add(pentest)
    db.session.commit()
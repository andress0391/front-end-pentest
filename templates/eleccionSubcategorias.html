{% extends "base/base2.html" %}

{% block content2 %}

{% from "_macro.html" import render_field %}

<div class="breadcrumbs">
    <div class="col-sm-4">
        <div class="page-header float-left">
            <div class="page-title">
                <h1>Personaliza tu pentest</h1>
            </div>
        </div>
    </div>
    <!--
                <div class="col-sm-8">
                    <div class="page-header float-right">
                        <div class="page-title">
                            <ol class="breadcrumb text-right">
                                <li class="active">Dashboard</li>
                            </ol>
                        </div>
                    </div>
                </div>
                -->
</div>

<form method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <div class="container">
        
        <div class="card">
            <h4 class="card-header">Datos para la autenticación de usuarios</h4>
            <div class="form-group">
                <label for="url_aut">Dirección de la página de autenticación</label>
                {{ render_field(form.url_ses, class="form-control", placeholder="http(s)://dominio.com/aplicacion/autenticacion") }}
            </div>
            <div class="row">
                <div class="col-4">
                    <label for="pass">Usuario de prueba</label>
                    {{ render_field(form.usuarioP, id="id_user",class="form-control", placeholder="") }}
                </div>
                <div class="col-4">
                    <label for="pass">Contraseña de prueba</label>
                    {{ render_field(form.passUsuarioP, id="id_pass" ,type="password", class="form-control", placeholder="") }}
                    <div class="form-check">
                        <label class="form-check-label">
                            <input class="form-check-input" type="checkbox" onclick="mostrarPass()"> Mostrar contraseña
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div id="accordion">
            {% for sc in subcat %}

            <div class="card">
                {% if sc.id == 1 %}

                <div class="card-header" id="heading_{{ sc.id }}">
                    <h5 class="mb-0">
                        <a href="#" class="btn btn-link" data-toggle="collapse" data-target="#collapse_{{ sc.id }}" aria-expanded="false" aria-controls="collapse_{{ sc.id }}">
                            {{ sc.sub_nombre | capitalize }}:
                            <small style="color: #FF530D;"> Esta subcategoría se ejecuta de forma automática. Pero debe responder las preguntas para calcular
                                el riesgo de negocio.</small>
                        </a>
                    </h5>
                </div>
                <div id="collapse_{{ sc.id }}" class="collapse" aria-labelledby="heading_{{ sc.id }}" data-parent="#accordion">
                    <div class="card-body">

                        <div class="card col-md-7">
                            <h4 class="card-header">Contenido de subcategoría</h4>
                            <table class="table table-inline">
                                <tr>
                                    <th>Código</th>
                                    <th>Nombre</th>
                                </tr>
                                {% for p in pruebas %} {% if p.id_subcategoria == sc.id %}
                                <tr>
                                    <td height="50"> {{p.codigo}} </td>
                                    <td height="50"> {{p.nombre}}
                                        <br>
                                    </td>
                                </tr>
                                {% endif %}
                                
                                {% endfor %}
                            </table>
                        </div>
                        <div id="id_div_hide_{{ sc.id }}">
                            <div class="card col-md-5">
                                <h4 class="card-header">Preguntas acerca del riesgo para el negocio</h4>
                                <fieldset>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Cúal sería la pérdida financiera si se llegara a explotar alguna vulnerabilidad?</label>
                                        <select class="form-control" id="pregunta1_{{ sc.id }}" name="pregunta1_{{ sc.id }}">
                                            <option value="1">Menor que la mitigación de la vulnerabilidad</option>
                                            <option value="1">Menor al beneficio anual</option>
                                            <option value="3">Mayor al beneficio anual</option>
                                            <option value="3">Bancarrota</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Si alguna de las vulnerabilidades es explotada, cúal sería el daño en términos de
                                            reputación del negocio?</label>
                                        <select class="form-control" id="pregunta2_{{ sc.id }}" name="pregunta2_{{ sc.id }}">
                                            <option value="1">Daño mínimo</option>
                                            <option value="2">Pérdida de cuentas</option>
                                            <option value="2">Pérdida de la buena imagen</option>
                                            <option value="3">Pérdida del valor de la marca</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Cuál sería el incumplimiento tanto normativo como legal, si su aplicación es vulnerada?</label>
                                        <select class="form-control" id="pregunta3_{{ sc.id }}" name="pregunta3_{{ sc.id }}">
                                            <option value="1">Incumplimiento menor</option>
                                            <option value="2">Claro incumplimiento</option>
                                            <option value="3">Alto incumplimiento</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Cuánta información personal sería revelada si alguna vunerabilidad es explotada?</label>
                                        <select class="form-control" id="pregunta4_{{ sc.id }}" name="pregunta4_{{ sc.id }}">
                                            <option value="1">Información de una persona</option>
                                            <option value="2">Información de centenares de personas</option>
                                            <option value="3">Información de miles de personas</option>
                                            <option value="3">Información de millones de personas</option>
                                        </select>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>

                {% else %}

                <div class="card-header" id="heading_{{ sc.id }}">
                    <h5 class="mb-0">
                        <input type="checkbox" id="id_sub_{{ sc.id }}" value="{{sc.id}}" name="name_{{sc.id}}" onchange="habilitarPreguntas( {{ sc.id }} )">
                        <a href="#" class="btn btn-link" data-toggle="collapse" data-target="#collapse_{{ sc.id }}" aria-expanded="false" aria-controls="collapse_{{ sc.id }}">
                            {{ sc.sub_nombre | capitalize }}
                        </a>
                    </h5>
                </div>

                {% endif %}

                <div id="collapse_{{ sc.id }}" class="collapse " aria-labelledby="heading_{{ sc.id }}" data-parent="#accordion">
                    <div class="card-body">

                        <div class="card col-md-7">
                            <h4 class="card-header">Contenido de subcategoría</h4>
                            <table class="table table-inline">
                                <tr>
                                    <th>Código</th>
                                    <th>Nombre</th>
                                </tr>
                                {% for p in pruebas %} {% if p.id_subcategoria == sc.id %}
                                <tr>
                                    <td height="50"> {{p.codigo}} </td>
                                    <td height="50"> {{p.nombre}}
                                        <br>
                                    </td>
                                </tr>
                                {% endif %} {% endfor %}
                            </table>
                        </div>
                        <div id="id_div_hide_{{ sc.id }}">
                            <div class="card col-md-5">
                                <h4 class="card-header">Preguntas acerca del riesgo para el negocio</h4>
                                <fieldset>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Cúal sería la pérdida financiera si se llegara a explotar alguna vulnerabilidad?</label>
                                        <select class="form-control" id="pregunta1_{{ sc.id }}" name="pregunta1_{{ sc.id }}" disabled>
                                            <option value="1">Menor que la mitigación de la vulnerabilidad</option>
                                            <option value="1">Menor al beneficio anual</option>
                                            <option value="3">Mayor al beneficio anual</option>
                                            <option value="3">Bancarrota</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Si alguna de las vulnerabilidades es explotada, cúal sería el daño en términos de
                                            reputación del negocio?</label>
                                        <select class="form-control" id="pregunta2_{{ sc.id }}" name="pregunta2_{{ sc.id }}" disabled>
                                            <option value="1">Daño mínimo</option>
                                            <option value="2">Pérdida de cuentas</option>
                                            <option value="2">Pérdida de la buena imagen</option>
                                            <option value="3">Pérdida del valor de la marca</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Cuál sería el incumplimiento tanto normativo como legal, si su aplicación es vulnerada?</label>
                                        <select class="form-control" id="pregunta3_{{ sc.id }}" name="pregunta3_{{ sc.id }}" disabled>
                                            <option value="1">Incumplimiento menor</option>
                                            <option value="2">Claro incumplimiento</option>
                                            <option value="3">Alto incumplimiento</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="disabledTextInput">¿Cuánta información personal sería revelada si alguna vunerabilidad es explotada?</label>
                                        <select class="form-control" id="pregunta4_{{ sc.id }}" name="pregunta4_{{ sc.id }}" disabled>
                                            <option value="1">Información de una persona</option>
                                            <option value="2">Información de centenares de personas</option>
                                            <option value="3">Información de miles de personas</option>
                                            <option value="3">Información de millones de personas</option>
                                        </select>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {% endfor %}

        </div>
        <button class="btn btn-primary" type="submit">Ejecutar pentest</button>
        <br>
        <br>
    </div>

</form>

<script>
    function habilitarPreguntas(id) {
        var x = document.getElementById("id_sub_" + id);
        if (x.checked === true) {
            for (i = 1; i <= 4; i++)
                var input = document.getElementById("pregunta" + i + "_" + id).disabled = false;
        }
        else {
            for (i = 1; i <= 4; i++)
                var input = document.getElementById("pregunta" + i + "_" + id).disabled = true;
        }
    }
    function mostrarPass() {
        var x = document.getElementById("id_pass");
        if (x.type === "password")
            x.type = "text";
        else
            x.type = "password";
    } 
</script>

{% endblock content2 %}